---
order: 1
---

import PubSubSub from "../_images/pubsubsub.png";

# PubSub

Applications communicate with each other through publish/subscribe (PubSub), an asynchronous messaging service that decouples services that produces messages from the services processing them.

An application can publish serializable data on a topic which is then sent to all subscribers. Applications can also subscribe to a topic to receive all the publications on this topic.

PubSub can be used internally on devices through the [PubSub library](https://libs.toit.io/pubsub/library-summary) and externally using the [PubSub GRPC API](https://github.com/toitware/api/tree/master/proto/toit/api/pubsub).

## Concepts

* topic: A named resource which is used when messages are published.

    * Device topic: A topic that enables intra-communication on the device. These topics will be prefixed with: `device:`

    * Cloud topic: A topic that enables inter-communication between devices and external systems. These topics will be prefixed with: `cloud:`

* subscription: an identifier of a stream of messages from a specific topic. Note that is possible to do concurrent reads on one subscription. When doing so, the concurrent reads will receive different batches of the same data set, making it easier to make ingestion concurrent.

* message: the combination of the data from the publisher and an identification of the sender.

See some examples of PubSub communication between apps in the [Tutorials](../../tutorials/pubsub/pubsubint) section.

## Cloud based PubSub subscriptions

<Tabs>
<Tab label="Console">

Go to the **PubSub** page and click on **Create Subscription**. The topic `cloud:topic-name` is the one defined in the Publisher Toit program. 
You can provide a name of the subscription, in order to give a description of the topic or in which scenarios it is used.

<img src={PubSubSub} alt="Screenshot of PubSub page on the Toit console" />

Once you have created a subscription, two graphs visualize the number of unacknowledged messages for that subscription, as well as the age of the oldest unacknowledged message for a specific time interval.

Delete a subscription with the bin icon.

Use the CLI commands to acknowledge messages for a subscription.

</Tab>
<Tab label="CLI">

Create a subscription with
```txt
toit pubsub subscription create <cloud:topic-name> <subscription-name>
```

To list existing subscriptions,
```shell
toit pubsub subscription list cloud:
```

To read a subscription and acknowledge messages as they are read, use
```txt
toit data read <cloud:topic-name> <subscription-name>
```

To automatically acknowledge messages, add the `--auto-ack` flag.

</Tab>
</Tabs>

## Additional PubSub features

PubSub messages can be sent from the cloud to one specific device only by providing the `device-id` in the command:

```txt
toit pubsub write cloud:<topic-name>?device-id=<id> <choose a name for the sender> -- <write a message>
```

It is also possible to create server-side PubSub subscriptions across multiple topics as long as they share a common prefix.

For example, create a subscription for the topics `cloud:foo/bar` and `cloud:foo/baz` with

```txt
toit pubsub subscription create "cloud:foo/*" <subscription-name>
```

