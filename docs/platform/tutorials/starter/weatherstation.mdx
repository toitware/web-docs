---
order: 100
---

import Qwiic from "../../_images/BME280.png";

# Weather station

In this tutorial we are using an ESP32 with the Bosch [BME280 sensor](https://www.bosch-sensortec.com/media/boschsensortec/downloads/datasheets/bst-bme280-ds002.pdf); an environmental sensor measuring temperature, the relative humidity, and the atmospheric pressure.

This example illustrates the difference between running a Toit program once on an ESP32 and deploying the same program as a long-lived app by using an app specification file.

The code examples shown in this tutorial are also available [here](https://github.com/toitware/bme280_post/tree/main/weather-station).

## Connect the sensor

<img src={Qwiic} alt="BME280" width="100%" />

Follow the steps [here](../../../../hardware/drivers/bme280) to connect the BME280 sensor with your ESP32 using a Qwiic cable.

## Run program on the ESP32

To get data from the sensor, we make use of the [bme280 sensor driver](https://libs.toit.io/drivers/bme280/library-summary) by importing it in the Toit program with `import drivers.bme280 as drivers`.

We also need to specify the [GPIO pins](../../../../hardware/peripherals/gpio) and the relevant [connection bus](../../../../hardware/peripherals).

```
// Save this program in a file named weather_station.toit
import gpio
import i2c
import drivers.bme280 as drivers

main:
  bus := i2c.Bus
    --sda=gpio.Pin 21
    --scl=gpio.Pin 22
  device := bus.device drivers.Bme280.I2C_ADDRESS_ALT
  bme := drivers.Bme280 device

  bme.on
  print "Temperature: $bme.read_temperature C"
  print "Humidity: $bme.read_humidity %"
  print "Pressure: $bme.read_pressure Pa"
  bme.off
```

Save the above Toit program in a file named `weather_station.toit`.

If you want to know more about what is happening in each step in the Toit program above, see [here](../../../../hardware/drivers/bme280#i2cbus).

<Tabs>
<Tab label="Console">

Open the [Toit console](https://console.toit.io), find your ESP32 in the list of devices, copy&paste the program above into the Code tab your online ESP32 with the
BME280 sensor connected, press the **Run on device** button and go to the **Logs
tab** of the device to see the measured temperature, humidity
and pressure values.

</Tab>
<Tab label="CLI">

To run the program once on the ESP32, execute the CLI command

```shell
toit run weather_station.toit
```

If you haven't set your default device in the CLI, add `-d device-name` to
the run command, where `device-name` is the name of your ESP32.

```shell
$ toit run weather_station.toit
2021-06-23T12:54:58.131899Z: <process initiated>
Temperature: 25.769999999999999574 C
Humidity: 42.111328125 %
Pressure: 101686.515625 Pa
2021-06-23T12:54:58.431812Z: <process terminated - exit code: 0>
```

</Tab>
</Tabs>

Running a Toit program in this way means that it will be uninstalled from the device once the program has terminated.

## Deploy app on the ESP32

We can use the same Toit program to repeatedly measure the temperature,
humidity, and pressure every 30 seconds by deploying it on the ESP32 using the
following app specification file:

```yaml
# filename: weather_station.yaml

# This app specification file executes the 'Weather Station' app on install
# and subsequently every 30 seconds.

name: Weather Station
entrypoint: weather_station.toit
triggers:
  on_install: true
  on_interval: 30s
```

Save the content of the above yaml specification into a file named

`weather_station.yaml`

located in the same directory as the `weather_station.toit` file from the previous
step.

Deploy the `Weather Station` app on your ESP32 with the CLI command

```shell
toit deploy weather_station.yaml
```

If you haven't set your default device in the CLI, add `-d device-name` to
the deploy command, where `device-name` is the name of your ESP32.

The device log will show the three measurements every 30 seconds after the program
has been installed on the device.

<Note>

The device is not required to be online when the 'Weather Station' app is deployed.
When the device comes online, the app will be installed on the device and start
it's scheduled execution.

</Note>

View all installed apps (or waiting to be installed) on your device from the
Apps tab.

## Uninstall an app

<Tabs>
<Tab label="Console">

To uninstall an app, click on the **Uninstall** button in the Apps tab of the device.

</Tab>
<Tab label="CLI">

To uninstall an app, run

```shell
toit device ps
```

to get the list of installed apps on your device.

Note the app ID or the app name, and replace it in the command:

```shell
toit device uninstall <app-ID or app-name>
```

For example,

```shell
toit device uninstall "Weather Station"
```

</Tab>
</Tabs>
